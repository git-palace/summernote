"use strict";!function(a){var b=navigator.appVersion.indexOf("Mac")>-1,c=navigator.userAgent.indexOf("MSIE")>-1,d=function(){var b=function(b){return function(c){return a(c).attr(b)}},c=function(b){return function(c){return a(c).hasClass(b)}},d=function(a){return function(b){return a===b}},e=function(){return!1};return{hasAttr:b,hasClass:c,eq:d,fail:e}}(),e=function(){var a=function(a){return a[0]},b=function(a){return a[a.length-1]},c=function(a){return a.slice(0,length-1)},d=function(a){return a.slice(1)},e=function(c,e){if(0===c.length)return[];var f=d(c);return f.reduce(function(a,c){var d=b(a);return e(b(d),c)?d[d.length]=c:a[a.length]=[c],a},[[a(c)]])},f=function(a){for(var b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b};return{head:a,last:b,initial:c,tail:d,compact:f,clusterBy:e}}(),f=function(){var b=function(a){return function(b){return b&&b.nodeName===a}},c=function(a){return a&&/^P|^LI|^H[1-7]/.test(a.nodeName)},e=function(a){return a&&/^UL|^OL/.test(a.nodeName)},f=function(a,b){for(;a;){if(b(a))return a;a=a.parentNode}return null},g=function(a,b){b=b||d.fail;var c=[];return f(a,function(a){return c.push(a),b(a)}),c},h=function(a,b){for(var c=g(a),d=b;d;d=d.parentNode)if(-1!=c.indexOf(d))return d;return null},i=function(a,b){for(var c,d=[],e=h(a,b),f=document.createNodeIterator(e,NodeFilter.SHOW_ALL,null,!1),g=!1;(c=f.nextNode())&&(a===c&&(g=!0),g&&d.push(c),b!==c););return d},j=function(a,b){b=b||d.fail;for(var c=[];a&&(c.push(a),a!==b);)a=a.nextSibling;return c},k=function(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a)},l=function(b,c){a.each(c,function(a,c){b.appendChild(c)})},m=b("#text"),n=function(a,b,c){var e=g(b,d.eq(a));e.reduce(function(a,d){var e=d.cloneNode(!1);return k(e,d),a===b&&c>0&&(m(a)&&a.splitText(c),a=a.nextSibling),l(e,j(a)),e})};return{isText:m,isPara:c,isList:e,isAnchor:b("A"),isDiv:b("DIV"),isSpan:b("SPAN"),isB:b("B"),isU:b("U"),isS:b("S"),isI:b("I"),ancestor:f,listAncestor:g,listNext:j,commonAncestor:h,listBetween:i,insertAfter:k,split:n}}(),g=!!document.createRange,h=function(b,c,d,h){if(0===arguments.length&&document.getSelection){var i=document.getSelection().getRangeAt(0);b=i.startContainer,c=i.startOffset,d=i.endContainer,h=i.endOffset}this.sc=b,this.so=c,this.ec=d,this.eo=h;var j=function(){if(g){var a=document.createRange();return a.setStart(b,c),a.setEnd(d,h),a}};this.select=function(){var a=j();g&&document.getSelection().addRange(a)},this.listPara=function(){var a=f.listBetween(b,d),c=e.compact(a.map(function(a){return f.ancestor(a,f.isPara)})),g=e.clusterBy(c,function(a,b){return a===b});return g.map(e.head)},this.isOnList=function(){var a=f.ancestor(b,f.isList),c=f.ancestor(d,f.isList);return a&&a===c},this.isOnAnchor=function(){var a=f.ancestor(b,f.isAnchor),c=f.ancestor(d,f.isAnchor);return a&&a===c},this.isCollapsed=function(){return b===d&&c===h},this.insertNode=function(a){var b=j();g&&b.insertNode(a)},this.surroundContents=function(b){var c=a("<"+b+" />")[0],d=j();return g&&d.surroundContents(c),c},this.toString=function(){var a=j();return g?a.toString():void 0}},i=function(){this.styleFont=function(b,c){var d=b.surroundContents("span");a.each(c,function(a,b){d.style[a]=b})},this.stylePara=function(b,c){var d=b.listPara();a.each(d,function(b,d){a.each(c,function(a,b){d.style[a]=b})})},this.current=function(b){var c=a(f.isText(b.sc)?b.sc.parentNode:b.sc),d=c.curStyles("font-size","font-weight","font-style","text-decoration","text-align","list-style-type","line-height")||{};if(d.fontSize=parseInt(d.fontSize),isNaN(parseInt(d.fontWeight))||(d.fontWeight=d.fontWeight>400?"bold":"normal"),b.isOnList()){var e=["circle","disc","disc-leading-zero","square"],g=-1!==e.indexOf(d.listStyleType);d.listStyle=g?"unordered":"ordered"}else d.listStyle="none";d.anchor=b.isOnAnchor()?f.ancestor(b.sc,f.isAnchor):null;var h=f.ancestor(b.sc,f.isPara);if(h&&h.style.lineHeight)d.lineHeight=h.style.lineHeight;else{var i=parseInt(d.lineHeight)/parseInt(d.fontSize);d.lineHeight=i.toFixed(1)}return d}},j=function(){var b=new i,d=function(a){return function(b){document.execCommand(a,!1,b)}};this.currentStyle=function(){var a=new h;return b.current(a)};for(var e=["bold","italic","underline","justifyLeft","justifyCenter","justifyRight","justifyFull","insertOrderedList","insertUnorderedList","indent","outdent","formatBlock","removeFormat","backColor","foreColor"],g=0,j=e.length;j>g;g++)this[e[g]]=d(e[g]);this.fontSize=function(a){b.styleFont(new h,{fontSize:a+"px"})},this.lineHeight=function(a){b.stylePara(new h,{lineHeight:a})},this.unlink=function(){var a=new h;if(a.isOnAnchor()){var b=f.ancestor(a.sc,f.isAnchor);a=new h(b,0,b,1),a.select(),document.execCommand("unlink")}},this.setLinkDialog=function(a){var b=new h;if(b.isOnAnchor()){var c=f.ancestor(b.sc,f.isAnchor);b=new h(c,0,c,1)}a({range:b,text:b.toString(),url:b.isOnAnchor()?f.ancestor(b.sc,f.isAnchor).href:""},function(a){b.select(),0!==a.toLowerCase().indexOf("http://")&&(a="http://"+a),document.execCommand("createlink",!1,a)})},this.color=function(a){var b=JSON.parse(a);this.foreColor(b.foreColor),this.backColor(b.backColor)},this.insertTable=function(b){for(var d,e=b.split("x"),f=e[0],g=e[1],i=[],j=c?"&nbsp;":"<br/>",k=0;f>k;k++)i.push("<td>"+j+"</td>");d=i.join("");for(var l,m=[],n=0;g>n;n++)m.push("<tr>"+d+"</tr>");l=m.join("");var o='<table class="table table-bordered">'+l+"</table>";(new h).insertNode(a(o)[0])},this.insertImage=function(a){document.execCommand("insertImage",!1,a)}},k=function(){this.update=function(b,c){var d=function(b,c){b.find(".dropdown-menu li a").each(function(){var b=a(this).attr("data-value")==c;this.className=b?"checked":""})},e=b.find(".note-fontsize");e.find(".note-current-fontsize").html(c.fontSize),d(e,parseFloat(c.fontSize));var f=b.find(".note-line-height");d(f,parseFloat(c.lineHeight));var g=function(a,c){var d=b.find(a);d[c()?"addClass":"removeClass"]("active")};g('button[data-event="bold"]',function(){return"bold"===c.fontWeight}),g('button[data-event="italic"]',function(){return"italic"===c.fontStyle}),g('button[data-event="underline"]',function(){return"underline"===c.textDecoration}),g('button[data-event="justifyLeft"]',function(){return"left"===c.textAlign||"start"===c.textAlign}),g('button[data-event="justifyCenter"]',function(){return"center"===c.textAlign}),g('button[data-event="justifyRight"]',function(){return"right"===c.textAlign}),g('button[data-event="justifyFull"]',function(){return"justify"===c.textAlign}),g('button[data-event="insertUnorderedList"]',function(){return"unordered"===c.listStyle}),g('button[data-event="insertOrderedList"]',function(){return"ordered"===c.listStyle})},this.updateRecentColor=function(b,c,e){var g=f.ancestor(b,d.hasClass("note-color")),h=a(g).find(".note-recent-color"),i=JSON.parse(h.attr("data-value"));i[c]=e,h.attr("data-value",JSON.stringify(i));var j="backColor"===c?"background-color":"color";h.find("i").css(j,e)}},l=function(){this.update=function(b,c){var d=b.find(".note-link-popover");if(c.anchor){var e=d.find("a");e.attr("href",c.anchor.href).html(c.anchor.href);var f=c.anchor.getBoundingClientRect();d.css({display:"block",left:f.left,top:a(document).scrollTop()+f.bottom})}else d.hide()},this.hide=function(a){a.children().hide()}},m=function(){this.showLinkDialog=function(a,b,c){var d=a.find(".note-link-dialog"),e=d.find(".note-link-text"),f=d.find(".note-link-url"),g=d.find(".note-link-btn");d.on("shown",function(){e.html(b.text),f.val(b.url).keyup(function(){f.val()?g.removeClass("disabled").attr("disabled",!1):g.addClass("disabled").attr("disabled",!0)}).trigger("focus"),g.click(function(){d.modal("hide"),c(f.val())})}).on("hidden",function(){f.off("keyup"),d.off("shown hidden"),g.off("click")}).modal("show")}},n=function(){var c=new j,e=new k,g=new l,h=new m,i={TAB:9,B:66,E:69,I:73,J:74,K:75,L:76,R:82,U:85,NUM0:48,NUM1:49,NUM4:52,NUM7:55,NUM8:56},n=function(d){var e=b?d.metaKey:d.ctrlKey,f=d.shiftKey;if(e&&d.keyCode===i.B)c.bold();else if(e&&d.keyCode===i.I)c.italic();else if(e&&d.keyCode===i.U)c.underline();else if(e&&d.keyCode===i.K)c.setLinkDialog(function(b,c){h.showLinkDialog(a(".note-dialog"),b,c)});else if(e&&f&&d.keyCode===i.L)c.justifyLeft();else if(e&&f&&d.keyCode===i.E)c.justifyCenter();else if(e&&f&&d.keyCode===i.R)c.justifyRight();else if(e&&f&&d.keyCode===i.J)c.justifyFull();else if(e&&f&&d.keyCode===i.NUM7)c.insertUnorderedList();else if(e&&f&&d.keyCode===i.NUM8)c.insertOrderedList();else if(f&&d.keyCode===i.TAB)c.outdent();else if(d.keyCode===i.TAB)c.indent();else if(e&&d.keyCode===i.NUM0)c.formatBlock("P");else{if(!(e&&i.NUM1<=d.keyCode&&d.keyCode<=i.NUM4))return;c.formatBlock("H"+String.fromCharCode(d.keyCode))}d.preventDefault()},o=function(b){var d=b.originalEvent.dataTransfer;d&&d.files&&a.each(d.files,function(a,b){var d=new FileReader;d.onload=function(a){c.insertImage(a.target.result)},d.readAsDataURL(b)}),b.stopPropagation(),b.preventDefault()},p=function(b){var d=b.currentTarget||b.target,f=a(d.parentNode),h=c.currentStyle();e.update(f.find(".note-toolbar"),h),g.update(f.find(".note-popover"),h)},q=function(b){var c=b.currentTarget||b.target,d=a(c.parentNode);g.hide(d.find(".note-popover"))},r=function(a){var b=f.ancestor(a.target,d.hasAttr("data-event"));b&&a.preventDefault()},s=function(b){var g=f.ancestor(b.target,d.hasAttr("data-event"));if(g){var i=a(g),j=i.attr("data-event"),k=i.attr("data-value");c[j]&&c[j](k),"backColor"===j||"foreColor"===j?e.updateRecentColor(g,j,k):"showLinkDialog"===j&&c.setLinkDialog(function(b,c){h.showLinkDialog(a(".note-dialog"),b,c)}),b.preventDefault(),p(b)}},t=18,u=function(b){var c,d=a(b.target.parentNode),e=d.next(),f=d.find(".note-dimension-picker-mousecatcher"),g=d.find(".note-dimension-picker-highlighted"),h=d.find(".note-dimension-picker-unhighlighted");if(void 0===b.offsetX){var i=a(b.target).offset();c={x:b.pageX-i.left,y:b.pageY-i.top}}else c={x:b.offsetX,y:b.offsetY};var j={c:Math.ceil(c.x/t)||1,r:Math.ceil(c.y/t)||1};g.css({width:j.c+"em",height:j.r+"em"}),f.attr("data-value",j.c+"x"+j.r),5<=j.c&&j.c<20&&h.css({width:j.c+1+"em"}),5<=j.r&&j.r<20&&h.css({height:j.r+1+"em"}),e.html(j.c+" x "+j.r)};this.attach=function(a){a.editable.on("keydown",n),a.editable.on("keyup mouseup",p),a.editable.on("scroll",q),a.editable.on("dragenter dragover dragleave",!1),a.editable.on("drop",o),a.toolbar.on("click",s),a.popover.on("click",s),a.toolbar.on("mousedown",r),a.popover.on("mousedown",r);var b=a.toolbar,c=b.find(".note-dimension-picker-mousecatcher");c.bind("mousemove",u)},this.dettach=function(a){a.editable.off(),a.toolbar.off(),a.popover.off()}},o=function(){var c='<div class="note-toolbar btn-toolbar"><div class="note-insert btn-group"><button class="btn btn-small" title="Picture"><i class="icon-picture"></i></button><button class="btn btn-small" title="Link" data-event="showLinkDialog" data-shortcut="Ctrl+K" data-mac-shortcut="⌘+K" ><i class="icon-link"></i></button></div><div class="note-table btn-group"><button class="btn btn-small dropdown-toggle" title="Table" data-toggle="dropdown"><i class="icon-table"></i> <span class="caret"></span></button><ul class="dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul></div><div class="note-style btn-group"><button class="btn btn-small dropdown-toggle" title="Style" data-toggle="dropdown"><i class="icon-magic"></i> <span class="caret"></span></button><ul class="dropdown-menu"><li><a href="#" data-event="formatBlock" data-value="p">Paragraph</a></li><li><a href="#" data-event="formatBlock" data-value="blockquote"><blockquote>Quote</blockquote></a></li><li><a href="#" data-event="formatBlock" data-value="h1"><h1>Header 1</h1></a></li><li><a href="#" data-event="formatBlock" data-value="h2"><h2>Header 2</h2></a></li><li><a href="#" data-event="formatBlock" data-value="h3"><h3>Header 3</h3></a></li><li><a href="#" data-event="formatBlock" data-value="h4"><h4>Header 4</h4></a></li></ul></div><div class="note-fontsize btn-group"><button class="btn btn-small dropdown-toggle" data-toggle="dropdown" title="Font Size"><span class="note-current-fontsize">11</span> <b class="caret"></b></button><ul class="dropdown-menu"><li><a href="#" data-event="fontSize" data-value="8"><i class="icon-ok"></i> 8</a></li><li><a href="#" data-event="fontSize" data-value="9"><i class="icon-ok"></i> 9</a></li><li><a href="#" data-event="fontSize" data-value="10"><i class="icon-ok"></i> 10</a></li><li><a href="#" data-event="fontSize" data-value="11"><i class="icon-ok"></i> 11</a></li><li><a href="#" data-event="fontSize" data-value="12"><i class="icon-ok"></i> 12</a></li><li><a href="#" data-event="fontSize" data-value="14"><i class="icon-ok"></i> 14</a></li><li><a href="#" data-event="fontSize" data-value="18"><i class="icon-ok"></i> 18</a></li><li><a href="#" data-event="fontSize" data-value="24"><i class="icon-ok"></i> 24</a></li><li><a href="#" data-event="fontSize" data-value="36"><i class="icon-ok"></i> 36</a></li></ul></div><div class="note-color btn-group"><button class="btn btn-small note-recent-color" title="Recent Color" data-event="color" data-value=\'{"foreColor":"black","backColor":"yellow"}\'><i class="icon-font" style="color:black;background-color:yellow;"></i></button><button class="btn btn-small dropdown-toggle" title="More Color" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">BackColor</div><div class="note-color-palette" data-target-event="backColor"></div></div><div class="btn-group"><div class="note-palette-title">FontColor</div><div class="note-color-palette" data-target-event="foreColor"></div></div></li></ul></div><div class="note-style btn-group"><button class="btn btn-small" title="Bold" data-shortcut="Ctrl+B" data-mac-shortcut="⌘+B" data-event="bold"><i class="icon-bold"></i></button><button class="btn btn-small" title="Italic" data-shortcut="Ctrl+I" data-mac-shortcut="⌘+I" data-event="italic"><i class="icon-italic"></i></button><button class="btn btn-small" title="Underline" data-shortcut="Ctrl+U" data-mac-shortcut="⌘+U" data-event="underline"><i class="icon-underline"></i></button><button class="btn btn-small" title="Remove Font Style" data-event="removeFormat"><i class="icon-eraser"></i></button></div><div class="note-para btn-group"><button class="btn btn-small" title="Unordered list" data-shortcut="Ctrl+Shift+8" data-mac-shortcut="⌘+⇧+7" data-event="insertUnorderedList"><i class="icon-list-ul"></i></button><button class="btn btn-small" title="Ordered list" data-shortcut="Ctrl+Shift+7" data-mac-shortcut="⌘+⇧+8" data-event="insertOrderedList"><i class="icon-list-ol"></i></button><button class="btn btn-small dropdown-toggle" title="Paragraph" data-toggle="dropdown"><i class="icon-align-left"></i>  <span class="caret"></span></button><ul class="dropdown-menu right"><li><div class="note-align btn-group"><button class="btn btn-small" title="Align left" data-shortcut="Ctrl+Shift+L" data-mac-shortcut="⌘+⇧+L" data-event="justifyLeft"><i class="icon-align-left"></i></button><button class="btn btn-small" title="Align center" data-shortcut="Ctrl+Shift+E" data-mac-shortcut="⌘+⇧+E" data-event="justifyCenter"><i class="icon-align-center"></i></button><button class="btn btn-small" title="Align right" data-shortcut="Ctrl+Shift+R" data-mac-shortcut="⌘+⇧+R" data-event="justifyRight"><i class="icon-align-right"></i></button><button class="btn btn-small" title="Justify full" data-shortcut="Ctrl+Shift+J" data-mac-shortcut="⌘+⇧+J" data-event="justifyFull"><i class="icon-align-justify"></i></button></div></li><li><div class="note-list btn-group"><button class="btn btn-small" title="Outdent" data-shortcut="Shift+TAB" data-mac-shortcut="⇧+TAB" data-event="outdent"><i class="icon-indent-left"></i></button><button class="btn btn-small" title="Indent" data-shortcut="TAB" data-mac-shortcut="TAB" data-event="indent"><i class="icon-indent-right"></i></button></li></ul></div><div class="note-line-height btn-group"><button class="btn btn-small dropdown-toggle" data-toggle="dropdown" title="Line Height"><i class="icon-text-height"></i>&nbsp; <b class="caret"></b></button><ul class="dropdown-menu right"><li><a href="#" data-event="lineHeight" data-value="1.0"><i class="icon-ok"></i> 1.0</a></li><li><a href="#" data-event="lineHeight" data-value="1.2"><i class="icon-ok"></i> 1.2</a></li><li><a href="#" data-event="lineHeight" data-value="1.4"><i class="icon-ok"></i> 1.4</a></li><li><a href="#" data-event="lineHeight" data-value="1.5"><i class="icon-ok"></i> 1.5</a></li><li><a href="#" data-event="lineHeight" data-value="1.6"><i class="icon-ok"></i> 1.6</a></li><li><a href="#" data-event="lineHeight" data-value="1.8"><i class="icon-ok"></i> 1.8</a></li><li><a href="#" data-event="lineHeight" data-value="2.0"><i class="icon-ok"></i> 2.0</a></li><li><a href="#" data-event="lineHeight" data-value="3.0"><i class="icon-ok"></i> 3.0</a></li></ul></div></div>',d='<div class="note-popover"><div class="note-link-popover popover fade bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content note-link-content"><a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group"><button class="btn btn-small" title="Edit" data-event="showLinkDialog"><i class="icon-edit"></i></button><button class="btn btn-small" title="Unlink" data-event="unlink"><i class="icon-unlink"></i></button></div></div></div></div>',e='<div class="note-dialog"><div class="note-link-dialog modal hide in" aria-hidden="false"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h4>Edit Link</h4></div><div class="modal-body"><div class="row-fluid"><label>Text to display</label><span class="note-link-text input-xlarge uneditable-input" /><label>To what URL should this link go?</label><input class="note-link-url span12" type="text" /></div></div><div class="modal-footer"><a href="#" class="btn disabled note-link-btn" data-event="editLink" disabled="disabled">Link</a></div></div></div>',f=function(c,d){c.find("button").each(function(c,d){var e=a(d),f=e.attr(b?"data-mac-shortcut":"data-shortcut");f&&e.attr("title",function(a,b){return b+" ("+f+")"})}).tooltip({container:"body",placement:d||"top"})},g=[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#EFF7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],h=function(b){b.find(".note-color-palette").each(function(){for(var b=a(this),c=b.attr("data-target-event"),d="",e=0,f=g.length;f>e;e++){for(var h=g[e],i="<div>",j=0,k=h.length;k>j;j++){var l=h[j],m=['<button class="note-color-btn" style="background-color:',l,';" data-event="',c,'" data-value="',l,'" title="',l,'" data-toggle="button"></button>'].join("");i+=m}i+="</div>",d+=i}b.html(d)})};this.createLayout=function(b,g){if(!b.next().hasClass("note-editor")){var i=a('<div class="note-editor"></div>'),j=a('<div class="note-editable" contentEditable="true"></div>').prependTo(i);g&&j.height(g),j.html(b.html());var k=a(c).prependTo(i);h(k),f(k,"bottom");var l=a(d).prependTo(i);f(l),a(e).prependTo(i),i.insertAfter(b),b.hide()}};var i=this.layoutInfo=function(a){var b=a.next();if(b.hasClass("note-editor"))return{editor:b,editable:b.find(".note-editable"),toolbar:b.find(".note-toolbar"),popover:b.find(".note-popover"),dialog:b.find(".note-dialog")}};this.removeLayout=function(a){var b=i(a);b&&(a.html(b.editable.html()),b.editor.remove(),a.show())}},p=new o,q=new n;a.fn.extend({summernote:function(a){a=a||{},p.createLayout(this,a.height);var b=p.layoutInfo(this);q.attach(b),a.focus&&b.editable.focus()},code:function(a){var b=p.layoutInfo(this);return void 0===a?b.editable.html():(b.editable.html(a),void 0)},destory:function(){var a=p.layoutInfo(this);q.dettach(a),p.removeLayout(this)},summernoteInner:function(){return{dom:f,list:e,func:d}}})}(jQuery);